<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen COSMIC Function Points</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .exam-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .exam-header {
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #3498db;
        }

        .exam-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .exam-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .timer-section {
            background: rgba(255,255,255,0.1);
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .exam-content {
            padding: 40px;
        }

        .instructions {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #2c3e50;
        }

        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .instructions ul {
            margin-left: 20px;
            line-height: 1.6;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .case-study {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .case-title {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .case-description {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 25px;
        }

        .requirements {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .requirements h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .req-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2c3e50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .questions-section {
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .question {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .question h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .answer-space {
            margin-top: 15px;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .analysis-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .analysis-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .analysis-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .analysis-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .total-row {
            background: #e7f3ff !important;
            font-weight: bold;
        }

        .submit-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(44, 62, 80, 0.3);
        }

        .highlight {
            background: rgba(44, 62, 80, 0.1);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: #2c3e50;
        }

        .start-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 15px;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .start-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .exam-disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .process-note {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        @media (max-width: 768px) {
            .exam-content {
                padding: 20px;
            }
            
            .exam-header h1 {
                font-size: 2rem;
            }
            
            .case-title {
                font-size: 1.5rem;
            }
            
            .analysis-table {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="exam-container">
        <div class="exam-header">
            <h1>üéØ Examen COSMIC Function Points</h1>
            <p>Evaluaci√≥n de Aplicabilidad del M√©todo COSMIC</p>
            
            <div class="timer-section">
                <h3>‚è±Ô∏è Tiempo del Examen</h3>
                <div class="timer" id="timer">45:00</div>
                <button id="start-timer" class="start-btn" onclick="startExam()">üöÄ Iniciar Examen</button>
                <div id="timer-status" style="margin-top: 10px; font-size: 1rem; opacity: 0.8;">Presiona el bot√≥n para comenzar</div>
            </div>
        </div>

        <div class="exam-content" id="exam-content">
            <div class="submit-section" style="margin-bottom: 30px; padding: 20px;">
                <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem;">üë§ Informaci√≥n del Participante</h3>
                <label for="participant-id" style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">
                    Nombre del Participante (requerido):
                </label>
                <input type="text" id="participant-id" class="answer-input" placeholder="Ingresa tu nombre completo" style="max-width: 400px; margin: 0 auto; display: block;" required>
            </div>

            <div class="instructions">
                <h3>üìã Instrucciones</h3>
                <ul>
                    <li><strong>Tiempo l√≠mite:</strong> 45 minutos para completar el examen</li>
                    <li><strong>Material de apoyo permitido:</strong> 
                        <ul style="margin-top: 8px;">
                            <li>‚úÖ Link de la Cheat sheet: <a href="https://drive.google.com/file/d/1gIzmTy-oBprPjBvArOBSWX8546AjKJz5/view?usp=sharing" target="_blank" style="color: #2c3e50; text-decoration: underline;">üìÑ Acceder al Cheat Sheet</a></li>
                            <li>‚úÖ Conocimientos aprendidos en el curso/tutorial</li>
                        </ul>
                    </li>
                    <li><strong>‚ö†Ô∏è PROHIBIDO:</strong> 
                        <ul style="margin-top: 8px; color: #dc3545;">
                            <li>‚ùå B√∫squedas en internet</li>
                            <li>‚ùå Consulta de otras fuentes externas</li>
                            <li>‚ùå Uso de herramientas autom√°ticas de c√°lculo</li>
                            <li>‚ùå Comunicaci√≥n con otras personas durante el examen</li>
                        </ul>
                    </li>
                    <li><strong>Objetivo:</strong> Aplicar COSMIC Function Points al caso de estudio</li>
                    <li><strong>Formato:</strong> Completa todas las secciones y justifica tus respuestas</li>
                    <li><strong>Evaluaci√≥n:</strong> Se medir√° la correctitud de tu an√°lisis COSMIC</li>
                </ul>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Recordatorio:</strong> Cada movimiento de datos = 1 CFP. Enf√≥cate en identificar los 4 tipos: Entrada (E), Salida (X), Lectura (R), Escritura (W).
            </div>

            <div class="case-study">
                <h2 class="case-title">üì± Caso de Estudio: Sistema de Gesti√≥n de Biblioteca</h2>
                
                <div class="case-description">
                    <p>Debes analizar el tama√±o funcional de un <strong>Sistema de Gesti√≥n de Biblioteca</strong> usando COSMIC Function Points. El sistema permite a bibliotecarios y usuarios gestionar el pr√©stamo de libros.</p>
                </div>

                <div class="process-note">
                    <strong>üìå IMPORTANTE:</strong> Cada requisito funcional describe un proceso funcional completo e independiente. Analiza cada uno por separado identificando todos sus movimientos de datos.
                </div>

                <div class="requirements">
                    <h4>üîç Descripci√≥n Funcional del Sistema</h4>
                    
                    <div class="req-item">
                        <strong>RF1 - Registro de nuevo usuario:</strong><br>
                        El bibliotecario ingresa los datos del nuevo usuario: nombre completo, n√∫mero de identificaci√≥n, tel√©fono y email. El sistema valida que el n√∫mero de identificaci√≥n no exista consultando la tabla de usuarios. Si el usuario no existe, guarda todos los datos en la tabla de usuarios y genera autom√°ticamente un n√∫mero de carnet √∫nico. El sistema muestra un mensaje de confirmaci√≥n con el n√∫mero de carnet asignado. Si el usuario ya existe, muestra un mensaje de error indicando que el n√∫mero de identificaci√≥n ya est√° registrado.
                    </div>

                    <div class="req-item">
                        <strong>RF2 - Consulta de disponibilidad de libros:</strong><br>
                        El usuario (bibliotecario o lector) ingresa el t√≠tulo o ISBN del libro que desea consultar. El sistema busca en la tabla de libros los datos del libro (t√≠tulo, autor, ubicaci√≥n, ISBN). Luego consulta la tabla de pr√©stamos activos para verificar si ese libro tiene un pr√©stamo vigente. Finalmente muestra la informaci√≥n completa del libro y su estado actual (disponible o prestado). Si el libro no existe, muestra un mensaje indicando que no se encontr√≥.
                    </div>

                    <div class="req-item">
                        <strong>RF3 - Registro de pr√©stamo:</strong><br>
                        El bibliotecario ingresa el n√∫mero de carnet del usuario y el ISBN del libro a prestar. El sistema consulta la tabla de usuarios para obtener los datos del usuario. Consulta la tabla de libros para verificar que el libro existe. Consulta la tabla de pr√©stamos activos para confirmar que el libro est√° disponible. Si todas las validaciones son correctas, crea un nuevo registro en la tabla de pr√©stamos con: ID pr√©stamo, carnet usuario, ISBN libro, fecha actual, fecha de devoluci√≥n (15 d√≠as despu√©s), estado "activo". Actualiza el registro del libro en la tabla de libros cambiando su estado a "prestado". Finalmente muestra un comprobante con todos los datos del pr√©stamo realizado.
                    </div>

                    <div class="req-item">
                        <strong>RF4 - Proceso de devoluci√≥n:</strong><br>
                        El bibliotecario ingresa el n√∫mero de carnet del usuario y el ISBN del libro a devolver. El sistema busca en la tabla de pr√©stamos el registro activo correspondiente a ese usuario y libro. Calcula los d√≠as de retraso comparando la fecha actual con la fecha de devoluci√≥n programada. Si hay retraso, consulta la tabla de tarifas para obtener el monto de multa por d√≠a. Actualiza el registro del pr√©stamo cambiando su estado a "devuelto" y registrando la fecha real de devoluci√≥n. Actualiza el registro del libro en la tabla de libros cambiando su estado a "disponible". Si hay multa, crea un nuevo registro en la tabla de multas con: ID multa, carnet usuario, monto, fecha, estado "pendiente". Muestra un mensaje con el resultado de la devoluci√≥n incluyendo el monto de multa si aplica.
                    </div>

                    <div class="req-item">
                        <strong>RF5 - Gesti√≥n de multas:</strong><br>
                        <strong>Proceso 1 - Consulta de multas:</strong> El bibliotecario ingresa el n√∫mero de carnet del usuario. El sistema busca en la tabla de multas todos los registros con estado "pendiente" de ese usuario. Calcula el total sumando los montos individuales. Muestra un reporte detallado con: lista de multas pendientes (fecha, monto, motivo) y el total adeudado.
                        <br><br>
                        <strong>Proceso 2 - Registro de pago:</strong> El bibliotecario ingresa el n√∫mero de carnet, el monto a pagar y el m√©todo de pago (efectivo/tarjeta). El sistema consulta las multas pendientes del usuario. Actualiza los registros de multas cambiando su estado a "pagada" hasta cubrir el monto pagado (puede ser pago parcial o total). Crea un registro en la tabla de pagos con: ID pago, carnet usuario, monto, m√©todo, fecha. Genera y muestra un comprobante de pago con el detalle de las multas pagadas.
                    </div>

                    <div class="req-item">
                        <strong>RF6 - Renovaci√≥n de pr√©stamo:</strong><br>
                        El bibliotecario ingresa el n√∫mero de carnet del usuario y el ISBN del libro a renovar. El sistema busca en la tabla de pr√©stamos el registro activo de ese pr√©stamo. Verifica que la fecha actual sea anterior a la fecha de vencimiento (no se permiten renovaciones de pr√©stamos vencidos). Consulta la tabla de multas para verificar que el usuario no tenga multas pendientes. Consulta la tabla de reservas para confirmar que no hay reservas activas de otros usuarios para ese libro. Si todas las validaciones son exitosas, actualiza el registro del pr√©stamo extendiendo la fecha de devoluci√≥n 15 d√≠as m√°s desde la fecha de vencimiento original. Crea un registro en la tabla de historial_renovaciones con: ID renovaci√≥n, ID pr√©stamo, fecha renovaci√≥n, nueva fecha devoluci√≥n. Muestra un mensaje de confirmaci√≥n con la nueva fecha de devoluci√≥n. Si alguna validaci√≥n falla, muestra el motivo espec√≠fico del rechazo.
                    </div>
                </div>
            </div>

            <div class="questions-section">
                <h3>üìä An√°lisis COSMIC - Completa la siguiente tabla</h3>
                
                <p style="margin-bottom: 20px;">Para cada requisito funcional, identifica y cuenta los movimientos de datos. Recuerda: <span class="highlight">E (Entrada), X (Salida), R (Lectura), W (Escritura)</span></p>

                <div class="process-note">
                    <strong>üí° Tip:</strong> RF5 contiene DOS procesos funcionales independientes. Debes analizarlos por separado y luego sumar los CFP.
                </div>

                <table class="analysis-table">
                    <thead>
                        <tr>
                            <th>Requisito Funcional</th>
                            <th>Entradas (E)</th>
                            <th>Salidas (X)</th>
                            <th>Lecturas (R)</th>
                            <th>Escrituras (W)</th>
                            <th>Total CFP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>RF1 - Registro de nuevo usuario</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr>
                            <td><strong>RF2 - Consulta disponibilidad</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr>
                            <td><strong>RF3 - Registro de pr√©stamo</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr>
                            <td><strong>RF4 - Proceso de devoluci√≥n</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr>
                            <td><strong>RF5 - Gesti√≥n de multas (TOTAL)</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr>
                            <td><strong>RF6 - Renovaci√≥n de pr√©stamo</strong></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="10" placeholder="0"></td>
                            <td><input type="number" min="0" max="20" placeholder="0" readonly style="background: #f8f9fa;"></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL DEL SISTEMA</strong></td>
                            <td><input type="number" placeholder="0" readonly style="background: #e7f3ff; font-weight: bold;"></td>
                            <td><input type="number" placeholder="0" readonly style="background: #e7f3ff; font-weight: bold;"></td>
                            <td><input type="number" placeholder="0" readonly style="background: #e7f3ff; font-weight: bold;"></td>
                            <td><input type="number" placeholder="0" readonly style="background: #e7f3ff; font-weight: bold;"></td>
                            <td><input type="number" placeholder="0" readonly style="background: #e7f3ff; font-weight: bold;" id="grand-total"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="questions-section">
                <h3>‚úçÔ∏è Preguntas de Justificaci√≥n</h3>
                
                <div class="question">
                    <h4>1. Explica tu razonamiento para RF1 (Registro de nuevo usuario)</h4>
                    <p>Identifica espec√≠ficamente qu√© consideraste como Entrada, Salida, Lectura y Escritura, y por qu√©.</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="4" placeholder="Escribe tu justificaci√≥n aqu√≠..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>2. Para RF3 (Registro de pr√©stamo), ¬øpor qu√© es importante distinguir entre los diferentes tipos de consultas a la base de datos?</h4>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="3" placeholder="Explica la diferencia entre las consultas realizadas..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>3. Analiza RF5 (Gesti√≥n de multas) - ¬øCu√°ntos procesos funcionales identificas?</h4>
                    <p>Este requisito describe m√∫ltiples operaciones. Explica si lo consideraste como un solo proceso o varios procesos separados y justifica tu decisi√≥n.</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="4" placeholder="Explica tu an√°lisis de los procesos en RF5..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>4. Para RF6 (Renovaci√≥n de pr√©stamo), identifica las validaciones que requieren lectura</h4>
                    <p>Enumera todas las consultas que el sistema debe realizar para validar si se puede renovar un pr√©stamo.</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="3" placeholder="Lista las validaciones que requieren consultar la base de datos..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>5. Identifica la frontera del sistema</h4>
                    <p>¬øQu√© incluiste dentro del sistema y qu√© consideraste como usuarios funcionales externos?</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="3" placeholder="Define la frontera del sistema..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>6. Compara la complejidad de los requisitos</h4>
                    <p>¬øCu√°l de los 6 requisitos consideras el m√°s complejo en t√©rminos de CFP y por qu√©? ¬øC√≥mo se relaciona esto con la complejidad percibida del desarrollo?</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="4" placeholder="Compara la complejidad funcional vs. complejidad de desarrollo..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>7. ¬øCu√°l es el tama√±o funcional total del sistema en CFP? ¬øTe parece un resultado razonable?</h4>
                    <div class="answer-space">
                        <input type="text" class="answer-input" placeholder="Total en CFP y comentario sobre si es razonable...">
                    </div>
                </div>

                <div class="question">
                    <h4>8. An√°lisis de RF4 (Devoluci√≥n) - ¬øC√≥mo manejas la creaci√≥n condicional de multas?</h4>
                    <p>En RF4, la multa solo se crea si hay retraso. ¬øEsto afecta el conteo de movimientos? Explica tu razonamiento.</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="3" placeholder="Explica c√≥mo cuentas los movimientos condicionales..."></textarea>
                    </div>
                </div>

                <div class="question">
                    <h4>9. Diferencia entre actualizaci√≥n y creaci√≥n de registros</h4>
                    <p>En varios requisitos hay actualizaciones (UPDATE) y creaciones (INSERT). ¬øAmbas cuentan como escrituras (W)? Justifica.</p>
                    <div class="answer-space">
                        <textarea class="answer-input" rows="3" placeholder="Explica si UPDATE e INSERT cuentan igual en COSMIC..."></textarea>
                    </div>
                </div>
            </div>

            <div class="submit-section">                
                <button class="submit-btn" onclick="finishExam()">üöÄ Finalizar y Enviar Examen</button>
                <p style="margin-top: 15px; color: #6c757d;">
                    Aseg√∫rate de haber completado todas las secciones antes de enviar
                </p>
            </div>
        </div>
    </div>

    <script>
        // Timer functionality
        let timeLeft = 45 * 60; // 45 minutes in seconds
        let timerInterval;
        let examStarted = false;
        let startTime;
        
        function startExam() {
            if (examStarted) return;
            
            examStarted = true;
            startTime = new Date();
            
            // Disable start button
            const startBtn = document.getElementById('start-timer');
            startBtn.disabled = true;
            startBtn.textContent = '‚è±Ô∏è Examen en Progreso';
            
            // Update status
            document.getElementById('timer-status').textContent = 'Examen iniciado - ¬°Buena suerte!';
            
            // Start timer
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running low
            const timerElement = document.getElementById('timer');
            if (timeLeft <= 300) { // 5 minutes
                timerElement.style.color = '#dc3545';
            } else if (timeLeft <= 600) { // 10 minutes
                timerElement.style.color = '#ffc107';
            }
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert('‚è∞ ¬°Tiempo agotado! El examen se enviar√° autom√°ticamente.');
                finishExam();
                return;
            }
            
            timeLeft--;
        }
        
        // Auto-calculate totals
        function calculateTotals() {
            const rows = document.querySelectorAll('.analysis-table tbody tr:not(.total-row)');
            let totalE = 0, totalX = 0, totalR = 0, totalW = 0, grandTotal = 0;
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="number"]:not([readonly])');
                let rowTotal = 0;
                
                inputs.forEach((input, index) => {
                    const value = parseInt(input.value) || 0;
                    rowTotal += value;
                    
                    // Add to column totals
                    switch(index) {
                        case 0: totalE += value; break;
                        case 1: totalX += value; break;
                        case 2: totalR += value; break;
                        case 3: totalW += value; break;
                    }
                });
                
                // Update row total
                row.querySelector('input[readonly]').value = rowTotal;
                grandTotal += rowTotal;
            });
            
            // Update total row
            const totalRow = document.querySelector('.total-row');
            const totalInputs = totalRow.querySelectorAll('input[readonly]');
            totalInputs[0].value = totalE;
            totalInputs[1].value = totalX;
            totalInputs[2].value = totalR;
            totalInputs[3].value = totalW;
            totalInputs[4].value = grandTotal;
        }
        
        // Add event listeners to calculate totals automatically
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[type="number"]:not([readonly])').forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
        });
        
        function collectExamData() {
            const participantId = document.getElementById('participant-id').value.trim();
            if (!participantId) {
                alert('Por favor ingresa tu nombre antes de enviar.');
                return null;
            }
            
            const endTime = new Date();
            const timeSpent = Math.round((endTime - startTime) / 1000); // seconds
            
            // Calcular tiempo transcurrido basado en el timer de forma m√°s precisa
            // Usar directamente el tiempo mostrado en el cron√≥metro
            const timerDisplayed = document.getElementById('timer').textContent;
            const [minutesLeft, secondsLeft] = timerDisplayed.split(':').map(Number);
            const timeLeftTotal = minutesLeft * 60 + secondsLeft;
            const timerSeconds = 45 * 60 - timeLeftTotal; // tiempo transcurrido exacto
            
            // Calcular minutos y segundos por separado para formato legible
            const minutosCompletos = Math.floor(timerSeconds / 60);
            const segundosRestantes = timerSeconds % 60;
            const tiempoLegible = `${minutosCompletos} minuto${minutosCompletos !== 1 ? 's' : ''} y ${segundosRestantes} segundo${segundosRestantes !== 1 ? 's' : ''}`;
            
            // Collect table data
            const tableData = {};
            const rows = document.querySelectorAll('.analysis-table tbody tr:not(.total-row)');
            rows.forEach((row, index) => {
                const rfName = ['RF1', 'RF2', 'RF3', 'RF4', 'RF5', 'RF6'][index];
                const inputs = row.querySelectorAll('input[type="number"]:not([readonly])');
                tableData[rfName] = {
                    entradas: parseInt(inputs[0].value) || 0,
                    salidas: parseInt(inputs[1].value) || 0,
                    lecturas: parseInt(inputs[2].value) || 0,
                    escrituras: parseInt(inputs[3].value) || 0,
                    total: parseInt(row.querySelector('input[readonly]').value) || 0
                };
            });
            
            // Collect totals
            const totalRow = document.querySelector('.total-row');
            const totalInputs = totalRow.querySelectorAll('input[readonly]');
            const totals = {
                totalEntradas: parseInt(totalInputs[0].value) || 0,
                totalSalidas: parseInt(totalInputs[1].value) || 0,
                totalLecturas: parseInt(totalInputs[2].value) || 0,
                totalEscrituras: parseInt(totalInputs[3].value) || 0,
                granTotal: parseInt(totalInputs[4].value) || 0
            };
            
            // Collect text answers
            const textAnswers = {};
            const textareas = document.querySelectorAll('textarea.answer-input');
            textAnswers.justificacionRF1 = textareas[0].value.trim();        // Pregunta 1
            textAnswers.distinguirConsultas = textareas[1].value.trim();     // Pregunta 2  
            textAnswers.analisisRF5 = textareas[2].value.trim();             // Pregunta 3
            textAnswers.validacionesRF6 = textareas[3].value.trim();         // Pregunta 4
            textAnswers.fronteraSistema = textareas[4].value.trim();         // Pregunta 5
            textAnswers.compararComplejidad = textareas[5].value.trim();     // Pregunta 6
            textAnswers.multasCondicionales = textareas[6].value.trim();     // Pregunta 8
            textAnswers.updateVsInsert = textareas[7].value.trim();          // Pregunta 9
            
            // ‚úÖ CORREGIDO: Buscar espec√≠ficamente el input de la pregunta 7
            // El primer input[type="text"] es el nombre del participante
            // El segundo input[type="text"] es la pregunta 7
            const allTextInputs = document.querySelectorAll('input[type="text"].answer-input');
            textAnswers.tama√±oTotal = allTextInputs[1].value.trim();              // Pregunta 7 (segundo input text)
            
            return {
                participantId,
                startTime: startTime.toISOString(),
                endTime: endTime.toISOString(),
                timeSpentSeconds: timerSeconds, // tiempo exacto en segundos
                timeSpentMinutes: Math.round((timerSeconds / 60) * 100) / 100, // tiempo en minutos decimales
                timeSpentReadable: tiempoLegible, // formato legible: "2 minutos y 5 segundos"
                tableData,
                totals,
                textAnswers,
                examCompleted: true
            };
        }
        
        function finishExam() {
            if (!examStarted) {
                alert('Debes iniciar el examen primero.');
                return;
            }
            
            const examData = collectExamData();
            if (!examData) return;
            
            const confirmSubmit = confirm('¬øEst√°s seguro de que quieres finalizar el examen? No podr√°s hacer cambios despu√©s.');
            if (confirmSubmit) {
                // Clear timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // Send data
                sendExamResults(examData);
                
                // Disable form
                document.getElementById('exam-content').classList.add('exam-disabled');
                
                alert('¬°Examen enviado correctamente! Gracias por tu participaci√≥n.');
            }
        }
        
        function sendExamResults(data) {
            // Console log para debugging
            console.log('RESULTADOS DEL EXAMEN COSMIC:', data);
            
            // Enviar autom√°ticamente a Google Forms
            submitToGoogleForms(data);
            
            // Descargar archivos como respaldo
            downloadResults(data);
            downloadTxtResults(data);
            
            alert(`¬°Examen enviado autom√°ticamente!

üìä Participante: ${data.participantId}
‚è±Ô∏è Tiempo: ${data.timeSpentReadable}
üéØ Total CFP: ${data.totals.granTotal}

‚úÖ Datos enviados exitosamente
üìÇ Archivos de respaldo descargados

¬°Gracias por tu participaci√≥n!`);
        }
        
        function submitToGoogleForms(data) {
            // URL de tu Google Form - CON TUS ENTRY IDS ACTUALIZADOS
            const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSf350RHlSlLJyh9fiUeiqA2fT1iTvvSG-s3FltYMTH54kpKhQ/formResponse';
            
            // Crear FormData con todos los campos usando los Entry IDs ACTUALIZADOS
            const formData = new FormData();
            
            // Mapeo completo con tus Entry IDs actualizados - INCLUYENDO LAS NUEVAS PREGUNTAS
            formData.append('entry.300475451', data.participantId);                    // 1. ID Participante
            formData.append('entry.1284686737', data.timeSpentReadable);               // 2. Tiempo Empleado en formato legible
            formData.append('entry.926759471', data.tableData.RF1.entradas);          // 3. RF1-E
            formData.append('entry.2050957752', data.tableData.RF1.salidas);          // 4. RF1-X
            formData.append('entry.1551223414', data.tableData.RF1.lecturas);         // 5. RF1-R
            formData.append('entry.1585264431', data.tableData.RF1.escrituras);       // 6. RF1-W
            formData.append('entry.570005580', data.tableData.RF1.total);             // 7. RF1-Total
            formData.append('entry.2137535049', data.tableData.RF2.entradas);         // 8. RF2-E
            formData.append('entry.374287656', data.tableData.RF2.salidas);           // 9. RF2-X
            formData.append('entry.16804855', data.tableData.RF2.lecturas);           // 10. RF2-R
            formData.append('entry.424256998', data.tableData.RF2.escrituras);        // 11. RF2-W
            formData.append('entry.477333604', data.tableData.RF2.total);             // 12. RF2-Total
            formData.append('entry.42304788', data.tableData.RF3.entradas);           // 13. RF3-E
            formData.append('entry.1161577330', data.tableData.RF3.salidas);          // 14. RF3-X
            formData.append('entry.1448828374', data.tableData.RF3.lecturas);         // 15. RF3-R
            formData.append('entry.642016889', data.tableData.RF3.escrituras);        // 16. RF3-W
            formData.append('entry.1968133146', data.tableData.RF3.total);            // 17. RF3-Total
            formData.append('entry.147781726', data.tableData.RF4.entradas);          // 18. RF4-E
            formData.append('entry.234893656', data.tableData.RF4.salidas);           // 19. RF4-X
            formData.append('entry.91219835', data.tableData.RF4.lecturas);           // 20. RF4-R
            formData.append('entry.384853585', data.tableData.RF4.escrituras);        // 21. RF4-W
            formData.append('entry.623657995', data.tableData.RF4.total);             // 22. RF4-Total
            formData.append('entry.809144775', data.tableData.RF5.entradas);          // 23. RF5-E
            formData.append('entry.1240997932', data.tableData.RF5.salidas);          // 24. RF5-X
            formData.append('entry.283902922', data.tableData.RF5.lecturas);          // 25. RF5-R
            formData.append('entry.347072477', data.tableData.RF5.escrituras);        // 26. RF5-W
            formData.append('entry.731554035', data.tableData.RF5.total);             // 27. RF5-Total
            formData.append('entry.537629101', data.tableData.RF6.entradas);          // 28. RF6-E
            formData.append('entry.779600758', data.tableData.RF6.salidas);           // 29. RF6-X
            formData.append('entry.496198568', data.tableData.RF6.lecturas);          // 30. RF6-R
            formData.append('entry.930168337', data.tableData.RF6.escrituras);        // 31. RF6-W
            formData.append('entry.2128805208', data.tableData.RF6.total);            // 32. RF6-Total
            formData.append('entry.1347442573', data.totals.granTotal);               // 33. Gran Total CFP
            formData.append('entry.1136182533', data.textAnswers.justificacionRF1);   // 34. Justificaci√≥n RF1
            formData.append('entry.1338129771', data.textAnswers.distinguirConsultas); // 35. Distinguir Consultas RF3
            formData.append('entry.1348082673', data.textAnswers.analisisRF5);        // 36. An√°lisis RF5
            formData.append('entry.1687498595', data.textAnswers.validacionesRF6);    // 37. Validaciones RF6
            formData.append('entry.836448848', data.textAnswers.fronteraSistema);     // 38. Frontera del Sistema
            formData.append('entry.629652452', data.textAnswers.compararComplejidad); // 39. Comparar Complejidad
            formData.append('entry.1716192422', data.textAnswers.tama√±oTotal);        // 40. Tama√±o Total
            // ‚úÖ NUEVAS PREGUNTAS AGREGADAS
            formData.append('entry.441861455', data.textAnswers.multasCondicionales); // 41. An√°lisis RF4 - Multas Condicionales
            formData.append('entry.531908254', data.textAnswers.updateVsInsert);      // 42. Diferencia UPDATE vs INSERT
            
            // Enviar datos usando fetch
            fetch(GOOGLE_FORM_URL, {
                method: 'POST',
                mode: 'no-cors', // Importante para Google Forms
                body: formData
            }).then(() => {
                console.log('‚úÖ Datos enviados exitosamente a Google Forms - TODAS las 42 entradas mapeadas correctamente');
                console.log('üìã Preguntas 1-7: Datos de tabla y preguntas textuales');
                console.log('üìã Pregunta 8 (entry.441861455): Multas condicionales RF4');
                console.log('üìã Pregunta 9 (entry.531908254): UPDATE vs INSERT');
            }).catch(error => {
                console.error('‚ùå Error al enviar a Google Forms:', error);
            });
        }
        
        function formatResultsForEmail(data) {
            return `RESULTADOS EXAMEN COSMIC FUNCTION POINTS
==========================================

ID Participante: ${data.participantId}
Tiempo de inicio: ${new Date(data.startTime).toLocaleString()}
Tiempo de finalizaci√≥n: ${new Date(data.endTime).toLocaleString()}
Tiempo total empleado: ${data.timeSpentReadable}

AN√ÅLISIS COSMIC:
================
RF1 - Registro nuevo usuario: E=${data.tableData.RF1.entradas}, X=${data.tableData.RF1.salidas}, R=${data.tableData.RF1.lecturas}, W=${data.tableData.RF1.escrituras} | Total: ${data.tableData.RF1.total} CFP
RF2 - Consulta disponibilidad: E=${data.tableData.RF2.entradas}, X=${data.tableData.RF2.salidas}, R=${data.tableData.RF2.lecturas}, W=${data.tableData.RF2.escrituras} | Total: ${data.tableData.RF2.total} CFP
RF3 - Registro pr√©stamo: E=${data.tableData.RF3.entradas}, X=${data.tableData.RF3.salidas}, R=${data.tableData.RF3.lecturas}, W=${data.tableData.RF3.escrituras} | Total: ${data.tableData.RF3.total} CFP
RF4 - Proceso devoluci√≥n: E=${data.tableData.RF4.entradas}, X=${data.tableData.RF4.salidas}, R=${data.tableData.RF4.lecturas}, W=${data.tableData.RF4.escrituras} | Total: ${data.tableData.RF4.total} CFP
RF5 - Gesti√≥n multas: E=${data.tableData.RF5.entradas}, X=${data.tableData.RF5.salidas}, R=${data.tableData.RF5.lecturas}, W=${data.tableData.RF5.escrituras} | Total: ${data.tableData.RF5.total} CFP
RF6 - Renovaci√≥n pr√©stamo: E=${data.tableData.RF6.entradas}, X=${data.tableData.RF6.salidas}, R=${data.tableData.RF6.lecturas}, W=${data.tableData.RF6.escrituras} | Total: ${data.tableData.RF6.total} CFP

TOTALES:
========
Total Entradas (E): ${data.totals.totalEntradas}
Total Salidas (X): ${data.totals.totalSalidas}  
Total Lecturas (R): ${data.totals.totalLecturas}
Total Escrituras (W): ${data.totals.totalEscrituras}
GRAN TOTAL: ${data.totals.granTotal} CFP

RESPUESTAS TEXTUALES:
===================
1. Justificaci√≥n RF1: ${data.textAnswers.justificacionRF1}
2. Distinguir consultas RF3: ${data.textAnswers.distinguirConsultas}
3. An√°lisis RF5: ${data.textAnswers.analisisRF5}
4. Validaciones RF6: ${data.textAnswers.validacionesRF6}
5. Frontera del sistema: ${data.textAnswers.fronteraSistema}
6. Comparar complejidad: ${data.textAnswers.compararComplejidad}
7. Tama√±o total: ${data.textAnswers.tama√±oTotal}
8. Multas condicionales: ${data.textAnswers.multasCondicionales}
9. Update vs Insert: ${data.textAnswers.updateVsInsert}`;
        }
        
        function downloadTxtResults(data) {
            const txtContent = formatResultsForEmail(data);
            const txtBlob = new Blob([txtContent], {type: 'text/plain'});
            const url = URL.createObjectURL(txtBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `cosmic_exam_results_${data.participantId}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        function downloadResults(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `cosmic_exam_results_${data.participantId}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // Warning before page unload
        window.addEventListener('beforeunload', function(e) {
            if (examStarted && !document.getElementById('exam-content').classList.contains('exam-disabled')) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
